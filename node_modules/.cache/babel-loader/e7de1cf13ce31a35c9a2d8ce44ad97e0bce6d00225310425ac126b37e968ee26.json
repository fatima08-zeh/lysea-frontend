{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Admin\\\\Desktop\\\\stage25\\\\frontend\\\\src\\\\context\\\\CartContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useState, useEffect, useContext } from \"react\";\nimport axios from \"axios\";\nimport { UserContext } from \"./UserContext\"; // âœ… VÃ©rifie ce chemin\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const CartContext = /*#__PURE__*/createContext();\nexport const CartProvider = ({\n  children\n}) => {\n  _s();\n  const {\n    user\n  } = useContext(UserContext);\n  const [cart, setCart] = useState([]);\n\n  // âœ… Charger le panier depuis la base de donnÃ©es lorsque l'utilisateur est connectÃ©\n  useEffect(() => {\n    if (user) {\n      console.log(\"ðŸ“¥ Chargement du panier pour l'utilisateur\", user.id);\n      axios.get(`http://localhost:5001/api/cart/${user.id}`).then(response => {\n        console.log(\"ðŸ“¦ Panier chargÃ© :\", response.data);\n        setCart(response.data);\n      }).catch(error => console.error(\"âŒ Erreur chargement panier :\", error));\n    }\n  }, [user]);\n\n  // âœ… Ajouter un produit au panier\n  const addToCart = product => {\n    setCart(prevCart => {\n      // VÃ©rifie si le produit est dÃ©jÃ  dans le panier\n      const existingProduct = prevCart.find(p => p.id === product.id);\n      if (existingProduct) {\n        // Si le produit est dÃ©jÃ  dans le panier, augmente la quantitÃ©\n        return prevCart.map(p => p.id === product.id ? {\n          ...p,\n          quantity: p.quantity + 1\n        } : p);\n      } else {\n        // Sinon, ajoute le produit avec une quantitÃ© initiale de 1\n        return [...prevCart, {\n          ...product,\n          quantity: 1\n        }];\n      }\n    });\n  };\n\n  // âœ… Supprimer un produit du panier\n  const removeFromCart = productId => {\n    if (!user) return;\n    axios.delete(`http://localhost:5000/api/cart/remove/${user.id}/${productId}`).then(() => {\n      setCart(prevCart => prevCart.filter(item => item.id !== productId));\n    }).catch(error => console.error(\"âŒ Erreur suppression produit :\", error));\n  };\n\n  // âœ… Vider le panier aprÃ¨s dÃ©connexion ou commande validÃ©e\n  const clearCart = () => {\n    setCart([]);\n  };\n\n  // âœ… Passer la commande et stocker dans `orders`\n  const checkout = async () => {\n    if (!user) {\n      alert(\"Veuillez vous connecter pour passer une commande.\");\n      return;\n    }\n    try {\n      const response = await axios.post(\"http://localhost:5000/api/orders/create\", {\n        userId: user.id,\n        products: cart.map(({\n          id,\n          quantity,\n          prix\n        }) => ({\n          productId: id,\n          quantity,\n          price: prix\n        })),\n        totalPrice: cart.reduce((acc, product) => acc + product.prix * product.quantity, 0)\n      });\n      if (response.data.success) {\n        alert(\"âœ… Commande validÃ©e !\");\n        clearCart();\n      } else {\n        alert(\"âŒ Erreur lors de la validation de la commande.\");\n      }\n    } catch (error) {\n      console.error(\"âŒ Erreur checkout :\", error);\n    }\n  };\n  const decreaseQuantity = productId => {\n    setCart(prevCart => prevCart.map(item => item.id === productId ? {\n      ...item,\n      quantity: item.quantity > 1 ? item.quantity - 1 : 1\n    } : item));\n  };\n  return /*#__PURE__*/_jsxDEV(CartContext.Provider, {\n    value: {\n      cart,\n      addToCart,\n      removeFromCart,\n      clearCart,\n      decreaseQuantity,\n      checkout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 9\n  }, this);\n};\n_s(CartProvider, \"XpZZFTfa3hwmi9+2k19OSfH20S8=\");\n_c = CartProvider;\nvar _c;\n$RefreshReg$(_c, \"CartProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","axios","UserContext","jsxDEV","_jsxDEV","CartContext","CartProvider","children","_s","user","cart","setCart","console","log","id","get","then","response","data","catch","error","addToCart","product","prevCart","existingProduct","find","p","map","quantity","removeFromCart","productId","delete","filter","item","clearCart","checkout","alert","post","userId","products","prix","price","totalPrice","reduce","acc","success","decreaseQuantity","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Admin/Desktop/stage25/frontend/src/context/CartContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport { UserContext } from \"./UserContext\"; // âœ… VÃ©rifie ce chemin\r\n\r\nexport const CartContext = createContext();\r\n\r\nexport const CartProvider = ({ children }) => {\r\n    const { user } = useContext(UserContext);\r\n    const [cart, setCart] = useState([]);\r\n\r\n    // âœ… Charger le panier depuis la base de donnÃ©es lorsque l'utilisateur est connectÃ©\r\n    useEffect(() => {\r\n        if (user) {\r\n            console.log(\"ðŸ“¥ Chargement du panier pour l'utilisateur\", user.id);\r\n            axios.get(`http://localhost:5001/api/cart/${user.id}`)\r\n                .then(response => {\r\n                    console.log(\"ðŸ“¦ Panier chargÃ© :\", response.data);\r\n                    setCart(response.data);\r\n                })\r\n                .catch(error => console.error(\"âŒ Erreur chargement panier :\", error));\r\n        }\r\n    }, [user]);\r\n    \r\n    \r\n    // âœ… Ajouter un produit au panier\r\n    const addToCart = (product) => {\r\n        setCart((prevCart) => {\r\n            // VÃ©rifie si le produit est dÃ©jÃ  dans le panier\r\n            const existingProduct = prevCart.find((p) => p.id === product.id);\r\n    \r\n            if (existingProduct) {\r\n                // Si le produit est dÃ©jÃ  dans le panier, augmente la quantitÃ©\r\n                return prevCart.map((p) =>\r\n                    p.id === product.id ? { ...p, quantity: p.quantity + 1 } : p\r\n                );\r\n            } else {\r\n                // Sinon, ajoute le produit avec une quantitÃ© initiale de 1\r\n                return [...prevCart, { ...product, quantity: 1 }];\r\n            }\r\n        });\r\n    };\r\n    \r\n    \r\n    \r\n\r\n    // âœ… Supprimer un produit du panier\r\n    const removeFromCart = (productId) => {\r\n        if (!user) return;\r\n\r\n        axios.delete(`http://localhost:5000/api/cart/remove/${user.id}/${productId}`)\r\n            .then(() => {\r\n                setCart(prevCart => prevCart.filter(item => item.id !== productId));\r\n            }).catch(error => console.error(\"âŒ Erreur suppression produit :\", error));\r\n    };\r\n\r\n    // âœ… Vider le panier aprÃ¨s dÃ©connexion ou commande validÃ©e\r\n    const clearCart = () => {\r\n        setCart([]);\r\n    };\r\n\r\n    // âœ… Passer la commande et stocker dans `orders`\r\n    const checkout = async () => {\r\n        if (!user) {\r\n            alert(\"Veuillez vous connecter pour passer une commande.\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await axios.post(\"http://localhost:5000/api/orders/create\", {\r\n                userId: user.id,\r\n                products: cart.map(({ id, quantity, prix }) => ({\r\n                    productId: id,\r\n                    quantity,\r\n                    price: prix\r\n                })),\r\n                totalPrice: cart.reduce((acc, product) => acc + product.prix * product.quantity, 0)\r\n            });\r\n\r\n            if (response.data.success) {\r\n                alert(\"âœ… Commande validÃ©e !\");\r\n                clearCart();\r\n            } else {\r\n                alert(\"âŒ Erreur lors de la validation de la commande.\");\r\n            }\r\n        } catch (error) {\r\n            console.error(\"âŒ Erreur checkout :\", error);\r\n        }\r\n    };\r\n    const decreaseQuantity = (productId) => {\r\n        setCart((prevCart) =>\r\n            prevCart.map((item) =>\r\n                item.id === productId\r\n                    ? { ...item, quantity: item.quantity > 1 ? item.quantity - 1 : 1 }\r\n                    : item\r\n            )\r\n        );\r\n    };\r\n    \r\n     \r\n    \r\n\r\n    return (\r\n        <CartContext.Provider value={{ cart, addToCart, removeFromCart, clearCart,decreaseQuantity, checkout }}>\r\n            {children}\r\n        </CartContext.Provider>\r\n    );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}