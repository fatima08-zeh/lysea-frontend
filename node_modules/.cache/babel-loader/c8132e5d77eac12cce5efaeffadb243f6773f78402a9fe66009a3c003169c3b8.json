{"ast":null,"code":"import React,{useEffect,useContext}from\"react\";import{useNavigate,useLocation}from\"react-router-dom\";import axios from\"axios\";import{UserContext}from\"../context/UserContext\";import{CartContext}from\"../context/CartContext\";import{jsx as _jsx}from\"react/jsx-runtime\";const PaypalSuccess=()=>{const navigate=useNavigate();const location=useLocation();const{user}=useContext(UserContext);const{clearCart}=useContext(CartContext);useEffect(()=>{const query=new URLSearchParams(location.search);const orderID=query.get(\"token\");// PayPal renvoie token=ORDER_ID\nconst capturePayment=async()=>{try{const resp=await axios.post(\"http://localhost:5001/api/checkout/capture-payment\",{orderID,userId:user===null||user===void 0?void 0:user.id});if(resp.status===200){clearCart();alert(\"✅ Paiement confirmé !\");navigate(\"/\");}else{alert(\"❌ La capture du paiement a échoué.\");navigate(\"/order\");}}catch(e){console.error(\"❌ Capture PayPal:\",e);alert(\"❌ Erreur lors de la capture du paiement.\");navigate(\"/order\");}};if(orderID)capturePayment();},[location.search,navigate,user,clearCart]);return/*#__PURE__*/_jsx(\"p\",{children:\"Traitement du paiement\\u2026\"});};export default PaypalSuccess;","map":{"version":3,"names":["React","useEffect","useContext","useNavigate","useLocation","axios","UserContext","CartContext","jsx","_jsx","PaypalSuccess","navigate","location","user","clearCart","query","URLSearchParams","search","orderID","get","capturePayment","resp","post","userId","id","status","alert","e","console","error","children"],"sources":["C:/Users/Admin/Desktop/stage25/frontend/src/pages/PaypalSuccess.js"],"sourcesContent":["import React, { useEffect, useContext } from \"react\";\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { UserContext } from \"../context/UserContext\";\r\nimport { CartContext } from \"../context/CartContext\";\r\n\r\nconst PaypalSuccess = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { user } = useContext(UserContext);\r\n  const { clearCart } = useContext(CartContext);\r\n\r\n  useEffect(() => {\r\n    const query = new URLSearchParams(location.search);\r\n    const orderID = query.get(\"token\"); // PayPal renvoie token=ORDER_ID\r\n\r\n    const capturePayment = async () => {\r\n      try {\r\n        const resp = await axios.post(\r\n          \"http://localhost:5001/api/checkout/capture-payment\",\r\n          { orderID, userId: user?.id }\r\n        );\r\n\r\n        if (resp.status === 200) {\r\n          clearCart();\r\n          alert(\"✅ Paiement confirmé !\");\r\n          navigate(\"/\");\r\n        } else {\r\n          alert(\"❌ La capture du paiement a échoué.\");\r\n          navigate(\"/order\");\r\n        }\r\n      } catch (e) {\r\n        console.error(\"❌ Capture PayPal:\", e);\r\n        alert(\"❌ Erreur lors de la capture du paiement.\");\r\n        navigate(\"/order\");\r\n      }\r\n    };\r\n\r\n    if (orderID) capturePayment();\r\n  }, [location.search, navigate, user, clearCart]);\r\n\r\n  return <p>Traitement du paiement…</p>;\r\n};\r\n\r\nexport default PaypalSuccess;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,UAAU,KAAQ,OAAO,CACpD,OAASC,WAAW,CAAEC,WAAW,KAAQ,kBAAkB,CAC3D,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,OAASC,WAAW,KAAQ,wBAAwB,CACpD,OAASC,WAAW,KAAQ,wBAAwB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAErD,KAAM,CAAAC,aAAa,CAAGA,CAAA,GAAM,CAC1B,KAAM,CAAAC,QAAQ,CAAGR,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAAS,QAAQ,CAAGR,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAES,IAAK,CAAC,CAAGX,UAAU,CAACI,WAAW,CAAC,CACxC,KAAM,CAAEQ,SAAU,CAAC,CAAGZ,UAAU,CAACK,WAAW,CAAC,CAE7CN,SAAS,CAAC,IAAM,CACd,KAAM,CAAAc,KAAK,CAAG,GAAI,CAAAC,eAAe,CAACJ,QAAQ,CAACK,MAAM,CAAC,CAClD,KAAM,CAAAC,OAAO,CAAGH,KAAK,CAACI,GAAG,CAAC,OAAO,CAAC,CAAE;AAEpC,KAAM,CAAAC,cAAc,CAAG,KAAAA,CAAA,GAAY,CACjC,GAAI,CACF,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAhB,KAAK,CAACiB,IAAI,CAC3B,oDAAoD,CACpD,CAAEJ,OAAO,CAAEK,MAAM,CAAEV,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEW,EAAG,CAC9B,CAAC,CAED,GAAIH,IAAI,CAACI,MAAM,GAAK,GAAG,CAAE,CACvBX,SAAS,CAAC,CAAC,CACXY,KAAK,CAAC,uBAAuB,CAAC,CAC9Bf,QAAQ,CAAC,GAAG,CAAC,CACf,CAAC,IAAM,CACLe,KAAK,CAAC,oCAAoC,CAAC,CAC3Cf,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF,CAAE,MAAOgB,CAAC,CAAE,CACVC,OAAO,CAACC,KAAK,CAAC,mBAAmB,CAAEF,CAAC,CAAC,CACrCD,KAAK,CAAC,0CAA0C,CAAC,CACjDf,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF,CAAC,CAED,GAAIO,OAAO,CAAEE,cAAc,CAAC,CAAC,CAC/B,CAAC,CAAE,CAACR,QAAQ,CAACK,MAAM,CAAEN,QAAQ,CAAEE,IAAI,CAAEC,SAAS,CAAC,CAAC,CAEhD,mBAAOL,IAAA,MAAAqB,QAAA,CAAG,8BAAuB,CAAG,CAAC,CACvC,CAAC,CAED,cAAe,CAAApB,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}