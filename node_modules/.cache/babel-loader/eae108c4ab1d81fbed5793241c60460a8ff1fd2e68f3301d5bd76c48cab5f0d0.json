{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from\"react\";import axios from\"axios\";import{UserContext}from\"./UserContext\";import{jsx as _jsx}from\"react/jsx-runtime\";export const CartContext=/*#__PURE__*/createContext();export const CartProvider=_ref=>{let{children}=_ref;const{user}=useContext(UserContext);const[cart,setCart]=useState([]);// Charger le panier depuis le localStorage lors de l'initialisation\nuseEffect(()=>{const storedCart=localStorage.getItem(\"cart\");if(storedCart){setCart(JSON.parse(storedCart));}},[]);// Sauvegarder le panier dans le localStorage √† chaque mise √† jour\nuseEffect(()=>{if(cart.length>0){localStorage.setItem(\"cart\",JSON.stringify(cart));}else{localStorage.removeItem(\"cart\");}},[cart]);useEffect(()=>{const loadCart=async()=>{if(user&&user.id){try{const url=`http://localhost:5001/api/cart/${user.id}`;console.log(\"üîó URL de r√©cup√©ration du panier :\",url);const response=await axios.get(url);console.log(\"üõí Panier charg√© pour l'utilisateur :\",user.id,response.data);setCart(response.data);}catch(error){console.error(\"‚ùå Erreur chargement du panier :\",error);setCart([]);}}else{console.warn(\"‚ö†Ô∏è ID utilisateur non d√©fini ou utilisateur non connect√©.\");}};loadCart();},[user]);// Ajouter un produit au panier\nconst addToCart=async product=>{try{const existingProduct=cart.find(item=>item.id===product.id);if(existingProduct){await axios.post(\"http://localhost:5001/api/cart/add\",{user_id:user.id,product_id:product.id,quantity:1});setCart(prevCart=>prevCart.map(item=>item.id===product.id?{...item,quantity:item.quantity+1}:item));}else{await axios.post(\"http://localhost:5001/api/cart/add\",{user_id:user.id,product_id:product.id,quantity:1});setCart(prevCart=>[...prevCart,{...product,quantity:1}]);}}catch(error){console.error(\"‚ùå Erreur ajout panier :\",error.message);}};// Vider le panier\nconst clearCart=async()=>{try{if(user){console.log(\"üßπ Tentative de vidage du panier...\");await axios.delete(`http://localhost:5001/api/cart/clear/${user.id}`);}setCart([]);localStorage.removeItem(\"cart\");// ‚úÖ Nettoyage propre du localStorage\nconsole.log(\"‚úÖ Panier vid√© avec succ√®s !\");}catch(error){console.error(\"‚ùå Erreur lors du vidage du panier :\",error);}};// Fonction pour supprimer un produit du panier\nconst removeFromCart=async productId=>{try{await axios.delete(`http://localhost:5001/api/cart/remove/${user.id}/${productId}`);// Mettre √† jour le panier local en supprimant uniquement l'√©l√©ment avec l'ID correspondant\nsetCart(prevCart=>prevCart.filter(item=>item.product_id!==productId));console.log(`üóëÔ∏è Produit avec ID ${productId} retir√© du panier.`);}catch(error){console.error(\"‚ùå Erreur lors de la suppression du produit du panier :\",error);}};// Incr√©menter la quantit√© d'un produit dans le panier\nconst increaseQuantity=async productId=>{try{await axios.post(\"http://localhost:5001/api/cart/add\",{user_id:user.id,product_id:productId,quantity:1});setCart(prevCart=>prevCart.map(item=>item.product_id===productId?{...item,quantity:item.quantity+1}:item));}catch(error){console.error(\"‚ùå Erreur lors de l'incr√©mentation :\",error);}};// Diminuer la quantit√© d'un produit\nconst decreaseQuantity=async productId=>{try{await axios.post(\"http://localhost:5001/api/cart/decrease\",{user_id:user.id,product_id:productId});setCart(prevCart=>prevCart.map(item=>item.product_id===productId&&item.quantity>1?{...item,quantity:item.quantity-1}:item));}catch(error){console.error(\"‚ùå Erreur lors de la d√©cr√©mentation :\",error);}};return/*#__PURE__*/_jsx(CartContext.Provider,{value:{cart,addToCart,removeFromCart,decreaseQuantity,increaseQuantity,clearCart},children:children});};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","axios","UserContext","jsx","_jsx","CartContext","CartProvider","_ref","children","user","cart","setCart","storedCart","localStorage","getItem","JSON","parse","length","setItem","stringify","removeItem","loadCart","id","url","console","log","response","get","data","error","warn","addToCart","product","existingProduct","find","item","post","user_id","product_id","quantity","prevCart","map","message","clearCart","delete","removeFromCart","productId","filter","increaseQuantity","decreaseQuantity","Provider","value"],"sources":["C:/Users/Admin/Desktop/stage25/frontend/src/context/CartContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { UserContext } from \"./UserContext\";\r\n\r\nexport const CartContext = createContext();\r\n\r\nexport const CartProvider = ({ children }) => {\r\n    const { user } = useContext(UserContext);\r\n    const [cart, setCart] = useState([]);\r\n\r\n\r\n    // Charger le panier depuis le localStorage lors de l'initialisation\r\n    useEffect(() => {\r\n        const storedCart = localStorage.getItem(\"cart\");\r\n        if (storedCart) {\r\n            setCart(JSON.parse(storedCart));\r\n        }\r\n    }, []);\r\n\r\n    // Sauvegarder le panier dans le localStorage √† chaque mise √† jour\r\n    useEffect(() => {\r\n        if (cart.length > 0) {\r\n            localStorage.setItem(\"cart\", JSON.stringify(cart));\r\n        } else {\r\n            localStorage.removeItem(\"cart\");\r\n        }\r\n    }, [cart]);\r\n\r\n    useEffect(() => {\r\n        const loadCart = async () => {\r\n            if (user && user.id) {\r\n                try {\r\n                    const url = `http://localhost:5001/api/cart/${user.id}`;\r\n                    console.log(\"üîó URL de r√©cup√©ration du panier :\", url);\r\n                    \r\n                    const response = await axios.get(url);\r\n                    console.log(\"üõí Panier charg√© pour l'utilisateur :\", user.id, response.data);\r\n                    setCart(response.data);\r\n                } catch (error) {\r\n                    console.error(\"‚ùå Erreur chargement du panier :\", error);\r\n                    setCart([]);\r\n                }\r\n            } else {\r\n                console.warn(\"‚ö†Ô∏è ID utilisateur non d√©fini ou utilisateur non connect√©.\");\r\n            }\r\n        };\r\n        loadCart();\r\n    }, [user]);\r\n\r\n    // Ajouter un produit au panier\r\n    const addToCart = async (product) => {\r\n        try {\r\n            const existingProduct = cart.find((item) => item.id === product.id);\r\n            if (existingProduct) {\r\n                await axios.post(\"http://localhost:5001/api/cart/add\", {\r\n                    user_id: user.id,\r\n                    product_id: product.id,\r\n                    quantity: 1,\r\n                });\r\n\r\n                setCart((prevCart) =>\r\n                    prevCart.map((item) =>\r\n                        item.id === product.id\r\n                            ? { ...item, quantity: item.quantity + 1 }\r\n                            : item\r\n                    )\r\n                );\r\n            } else {\r\n                await axios.post(\"http://localhost:5001/api/cart/add\", {\r\n                    user_id: user.id,\r\n                    product_id: product.id,\r\n                    quantity: 1,\r\n                });\r\n                setCart((prevCart) => [...prevCart, { ...product, quantity: 1 }]);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"‚ùå Erreur ajout panier :\", error.message);\r\n        }\r\n    };\r\n\r\n    // Vider le panier\r\nconst clearCart = async () => {\r\n    try {\r\n        if (user) {\r\n            console.log(\"üßπ Tentative de vidage du panier...\");\r\n            await axios.delete(`http://localhost:5001/api/cart/clear/${user.id}`);\r\n        }\r\n        setCart([]);\r\n        localStorage.removeItem(\"cart\"); // ‚úÖ Nettoyage propre du localStorage\r\n        console.log(\"‚úÖ Panier vid√© avec succ√®s !\");\r\n    } catch (error) {\r\n        console.error(\"‚ùå Erreur lors du vidage du panier :\", error);\r\n    }\r\n};\r\n\r\n\r\n// Fonction pour supprimer un produit du panier\r\nconst removeFromCart = async (productId) => {\r\n    try {\r\n        await axios.delete(`http://localhost:5001/api/cart/remove/${user.id}/${productId}`);\r\n        \r\n        // Mettre √† jour le panier local en supprimant uniquement l'√©l√©ment avec l'ID correspondant\r\n        setCart((prevCart) =>\r\n            prevCart.filter((item) => item.product_id !== productId)\r\n        );\r\n        console.log(`üóëÔ∏è Produit avec ID ${productId} retir√© du panier.`);\r\n    } catch (error) {\r\n        console.error(\"‚ùå Erreur lors de la suppression du produit du panier :\", error);\r\n    }\r\n};\r\n\r\n\r\n// Incr√©menter la quantit√© d'un produit dans le panier\r\nconst increaseQuantity = async (productId) => {\r\n    try {\r\n        await axios.post(\"http://localhost:5001/api/cart/add\", {\r\n            user_id: user.id,\r\n            product_id: productId,\r\n            quantity: 1,\r\n        });\r\n\r\n        setCart((prevCart) =>\r\n            prevCart.map((item) =>\r\n                item.product_id === productId\r\n                    ? { ...item, quantity: item.quantity + 1 }\r\n                    : item\r\n            )\r\n        );\r\n    } catch (error) {\r\n        console.error(\"‚ùå Erreur lors de l'incr√©mentation :\", error);\r\n    }\r\n};\r\n\r\n// Diminuer la quantit√© d'un produit\r\nconst decreaseQuantity = async (productId) => {\r\n    try {\r\n        await axios.post(\"http://localhost:5001/api/cart/decrease\", {\r\n            user_id: user.id,\r\n            product_id: productId,\r\n        });\r\n\r\n        setCart((prevCart) =>\r\n            prevCart.map((item) =>\r\n                item.product_id === productId && item.quantity > 1\r\n                    ? { ...item, quantity: item.quantity - 1 }\r\n                    : item\r\n            )\r\n        );\r\n    } catch (error) {\r\n        console.error(\"‚ùå Erreur lors de la d√©cr√©mentation :\", error);\r\n    }\r\n};\r\n\r\n\r\n    return (\r\n        <CartContext.Provider value={{ cart, addToCart, removeFromCart, decreaseQuantity, increaseQuantity, clearCart }}>\r\n            {children}\r\n        </CartContext.Provider>\r\n    );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}